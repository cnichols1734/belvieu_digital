{% extends "base.html" %}

{% block title %}Client Created — Belvieu Digital{% endblock %}

{% block content %}
{% include 'admin/_nav.html' %}

<div class="cta-page">
    <svg class="cta-page-icon" style="color: var(--green-500);" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
    </svg>
    <h1>Client Created</h1>
    <p>
        <strong>{{ prospect.business_name }}</strong> has been converted.
        Send them the invite link below to get started.
    </p>
</div>

<div class="card" style="max-width: 720px; margin: 0 auto;">
    <div class="card-header">Invite Link</div>
    <p class="text-sm text-muted mb-1">Copy this link and send it to your client. It expires in 30 days.</p>

    <div class="admin-invite-link-box">
        <input type="text" class="form-control" id="invite-link-input"
               value="{{ invite_link }}" readonly onclick="this.select()">
        <button type="button" class="btn btn-primary btn-sm" onclick="copyInviteLink()">Copy</button>
    </div>

    {% if invite.email %}
    <p class="form-hint mt-1">Locked to: {{ invite.email }}</p>
    {% endif %}

    <hr class="divider">

    <div class="content-grid">
        <div>
            <span class="text-muted text-sm">Workspace</span>
            <p class="font-medium">{{ workspace.name }}</p>
        </div>
        <div>
            <span class="text-muted text-sm">Site Slug</span>
            <p class="font-medium font-mono">/{{ site.site_slug }}/</p>
        </div>
        <div>
            <span class="text-muted text-sm">Published URL</span>
            <p class="font-medium">{{ site.published_url or '—' }}</p>
        </div>
        <div>
            <span class="text-muted text-sm">Status</span>
            <p>
                <span class="badge badge-{{ site.status }}">
                    <span class="badge-dot"></span>
                    {{ site.status | title }}
                </span>
            </p>
        </div>
    </div>

    <hr class="divider">

    <div class="flex gap-1">
        <a href="{{ url_for('admin.workspace_detail', workspace_id=workspace.id) }}" class="btn btn-primary">
            Go to Workspace
        </a>
        <a href="{{ url_for('admin.prospect_list') }}" class="btn btn-ghost">
            Back to Prospects
        </a>
    </div>
</div>

{# Send Invite Email #}
<div class="card" style="max-width: 720px; margin: 1.5rem auto 0;">
    <div class="card-header">Send Invite Email</div>
    <p class="text-sm text-muted mb-1">Send a branded email with the invite link to your client.</p>

    <form method="POST" action="{{ url_for('admin.send_invite_email', workspace_id=workspace.id) }}">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <input type="hidden" name="invite_link" value="{{ invite_link }}">

        <div class="form-group">
            <label for="recipient_email">Recipient Email</label>
            <input type="email" id="recipient_email" name="recipient_email" class="form-control"
                   value="{{ recipient_email or '' }}" placeholder="client@example.com" required>
        </div>

        <div class="form-group">
            <label for="custom_message">Custom Message <span class="text-muted">(optional)</span></label>
            <textarea id="custom_message" name="custom_message" class="form-control" rows="4"
                      placeholder="I built a custom website for {{ prospect.business_name }}...">I built a custom website for {{ prospect.business_name }}. I think you'll love it -- click the link below to set up your account and take a look.</textarea>
        </div>

        <button type="submit" class="btn btn-primary">
            <svg style="width: 16px; height: 16px;" viewBox="0 0 20 20" fill="currentColor"><path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/><path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/></svg>
            Send Invite Email
        </button>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
function copyInviteLink() {
    const input = document.getElementById('invite-link-input');
    input.select();
    input.setSelectionRange(0, 99999);
    navigator.clipboard.writeText(input.value).then(function() {
        const btn = input.nextElementSibling;
        btn.textContent = 'Copied!';
        setTimeout(function() { btn.textContent = 'Copy'; }, 2000);
    });
}
</script>
{% endblock %}
